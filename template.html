<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Wrapped</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #79b436;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }

        html.lenis {
            height: auto;
        }

        .lenis.lenis-smooth {
            scroll-behavior: auto;
        }

        .lenis.lenis-smooth [data-lenis-prevent] {
            overscroll-behavior: contain;
        }

        .lenis.lenis-stopped {
            overflow: hidden;
        }

        .lenis.lenis-scrolling iframe {
            pointer-events: none;
        }

        /* Container for all scrollytelling sections */
        #app {
            width: 100%;
            position: relative;
        }

        /* Individual Story Block */
        .story-block {
            /* 150vh creates the "slow" and "high-res" feel by forcing more scroll distance */
            min-height: 150vh;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 2rem;
            box-sizing: border-box;
            will-change: transform, opacity;
        }

        .content-wrapper {
            max-width: 900px;
            text-align: center;
            z-index: 2;
        }

        .headline {
            font-size: clamp(2.5rem, 5vw, 5rem);
            font-weight: 800;
            margin-bottom: 1rem;
            line-height: 1.1;
            /* Adjusted for light background: Dark gray to black gradient for premium look */
            background: linear-gradient(45deg, #000, #333);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Specific styles for stats */
        .stat-value-container {
            margin: 2rem 0;
            perspective: 1000px;
            /* For 3D pop effect */
        }

        .stat-value {
            font-size: clamp(5rem, 12vw, 10rem);
            font-weight: 800;
            color: var(--accent-color);
            display: inline-block;
            /* Changed to inline-block for transforms */
            line-height: 1;
            text-shadow: 0 10px 30px rgba(121, 180, 54, 0.2);
            will-change: transform, color;
        }

        .stat-unit {
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            font-weight: 300;
            color: var(--accent-color);
            display: block;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtext {
            font-size: clamp(2.4rem, 4vw, 3.6rem);
            font-weight: 300;
            color: var(--accent-color);
            /* The requested #79b436 */
            margin-bottom: 2rem;
            line-height: 1.5;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            will-change: transform, opacity;
        }

        .hero-subtext,
        .outro-subtext {
            color: var(--accent-color);
        }

        /* Scroll Progress Indicator */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 6px;
            background: var(--accent-color);
            width: 0%;
            z-index: 100;
        }
    </style>
</head>

<body>

    <div class="progress-bar"></div>
    <div id="app"></div>

    <!-- Data Source -->
    <script src="data.js"></script>

    <!-- Lenis for Smooth Scrolling -->
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <!-- GSAP Libraries via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script>
        // LOGIC SECTION
        document.addEventListener("DOMContentLoaded", () => {
            gsap.registerPlugin(ScrollTrigger);
            const app = document.getElementById('app');

            // --- SMOTH SCROLL SETUP (LENIS) ---
            const lenis = new Lenis({
                duration: 1.5, // Even slower/smoother
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                direction: 'vertical',
                gestureDirection: 'vertical',
                smooth: true,
                mouseMultiplier: 1,
                smoothTouch: false,
                touchMultiplier: 2,
            });

            lenis.on('scroll', ScrollTrigger.update);
            gsap.ticker.add((time) => {
                lenis.raf(time * 1000);
            });
            gsap.ticker.lagSmoothing(0);

            // --- CONTENT RENDERING ---
            const data = window.wrappedData || [];

            data.forEach((item, index) => {
                const section = document.createElement('section');
                section.className = `story-block type-${item.type}`;
                section.id = `block-${index}`;
                section.dataset.bgcolor = '#ffffff';

                let contentHTML = '';

                if (item.type === 'hero') {
                    contentHTML = `
                        <div class="headline hero-text" style="font-size: clamp(6rem, 16vw, 12rem);">${item.text}</div>
                        <div class="subtext hero-subtext" style="font-size: 3rem; letter-spacing: 3px; text-transform: uppercase;">${item.subtext}</div>
                    `;
                } else if (item.type === 'stat') {
                    // Start Image logic
                    let imageHTML = '';
                    if (item.image) {
                        const imgStr = item.image.trim();
                        if (imgStr.startsWith('<svg') || imgStr.startsWith('<?xml')) {
                             // It's raw SVG
                             imageHTML = `<div class="svg-container" style="max-height: 200px; display: block; margin: 0 auto 1rem auto; width: 100%; display: flex; justify-content: center;">${item.image}</div>`;
                        } else {
                            // It's a URL or Base64
                            imageHTML = `<img src="${item.image}" alt="${item.header}" style="max-height: 200px; display: block; margin: 0 auto 1rem auto;">`;
                        }
                    }
                    // End Image logic
                    contentHTML = `
                        <div class="headline stat-header">${item.header}</div>
                        <div class="stat-value-container">
                            <span class="stat-value">${item.value}</span>
                            <span class="stat-unit">${item.unit}</span>
                        </div>
                        <div class="subtext stat-context">${item.context}</div>
                        ${imageHTML}
                    `;
                } else if (item.type === 'text') {
                    contentHTML = `
                        <div class="headline text-only" style="font-weight: 500;">${item.text}</div>
                    `;
                } else if (item.type === 'outro') {
                    contentHTML = `
                        <div class="headline outro-text" style="font-size: clamp(6rem, 16vw, 12rem);">${item.text}</div>
                        <div class="subtext outro-subtext">${item.subtext}</div>
                    `;
                }

                section.innerHTML = `
                    <div class="content-wrapper">
                        ${contentHTML}
                    </div>
                `;
                app.appendChild(section);
            });

            // --- ANIMATION SETUP ---
            const sections = gsap.utils.toArray('.story-block');

            sections.forEach((section, i) => {
                const isHero = i === 0;
                const content = section.querySelector('.content-wrapper');
                const statValue = section.querySelector('.stat-value');
                const subtexts = section.querySelectorAll('.subtext, .stat-unit');

                // 1. Entrance / Flow
                // Continuous flow: Things slide up and stay visible until they go off top naturally.
                // We still want them to "enter" gracefully though.
                if (isHero) {
                    gsap.set(content, { opacity: 0, y: 50 });
                    gsap.to(content, {
                        opacity: 1,
                        y: 0,
                        duration: 1.5,
                        ease: "power3.out",
                        delay: 0.2
                    });
                } else {
                    // Access the data item for this section
                    const item = data[i];

                if (item.animation === 'fadeInOut') {
                     gsap.fromTo(content, {
                        opacity: 0
                    }, {
                        opacity: 0, 
                        keyframes: {
                            "0%":   { opacity: 0, y: "20vh" },
                            "40%":  { opacity: 1, y: 0 },   // Fully visible near center
                            "60%":  { opacity: 1, y: 0 },   // Stay visible for a bit
                            "100%": { opacity: 0, y: "-20vh" } // Fade out as it goes up
                        },
                        scrollTrigger: {
                            trigger: section,
                            start: "top bottom",   // When top of section hits bottom of viewport
                            end: "bottom top",     // Wait until it hits top to fade out
                            scrub: true            // Smooth scrubbing
                        },
                        ease: "none"
                    });
                } else if (item.animation === 'zoomReveal') {
                    gsap.fromTo(content, {
                        scale: 0.5,
                        opacity: 0
                    }, {
                        keyframes: {
                            "0%":   { scale: 0.5, opacity: 0 },
                            "50%":  { scale: 1.2, opacity: 1 },
                            "100%": { scale: 1.0, opacity: 1 }
                        },
                        scrollTrigger: {
                            trigger: section,
                            start: "top 90%",
                            end: "bottom top",
                            scrub: 1
                        },
                        ease: "none"
                    });
                } else if (item.animation === 'sideEntrance') {
                    gsap.fromTo(content, {
                        x: "-100vw",
                        opacity: 0
                    }, {
                        scrollTrigger: {
                            trigger: section,
                            start: "top bottom",
                            end: "center center", // Extend duration
                            scrub: 1
                        },
                        x: 0,
                        opacity: 1,
                        ease: "power2.out"
                    });
                } else if (item.animation === 'slideRight') {
                    gsap.fromTo(content, {
                        x: "100vw",
                        opacity: 0
                    }, {
                        scrollTrigger: {
                            trigger: section,
                            start: "top bottom",
                            end: "center center", 
                            scrub: 1
                        },
                        x: 0,
                        opacity: 1,
                        ease: "power2.out"
                    });
                } else {
                    // Animation: 'slideUp' (Default)
                    // explicitly check for 'slideUp' or fallback for undefined
                    gsap.fromTo(content, {
                        opacity: 0,
                        y: 150 // Start lower down
                    }, {
                        scrollTrigger: {
                            trigger: section,
                            start: "top 80%", // Start animating when section top hits 80% viewport
                            end: "top 40%",   // Fully visible by 40% viewport
                            scrub: 1,
                            toggleActions: "play none none reverse"
                        },
                        opacity: 1,
                        y: 0,
                        ease: "power2.out"
                    });
                }
                }

                // *NO EXIT ANIMATION* - We removed the code that fades it out at "top -20%".

                // IMAGE ANIMATION (Simple pop in)
                const img = content.querySelector('img');
                if (img) {
                    gsap.fromTo(img, { scale: 0.8, opacity: 0 }, {
                        scale: 1,
                        opacity: 1,
                        duration: 0.5,
                        ease: "back.out(1.7)",
                        scrollTrigger: {
                            trigger: section,
                            start: "top 70%",
                        }
                    });
                }

                // 2. Value Highlighting ("Pop" Effect)
                // Only apply if it's the default (slideUp) or fadeInOut. 
                // Don't apply for special entrances to keep them clean.
                let currentAnim; 
                if (data[i]) {
                    currentAnim = data[i].animation;
                }
                
                if (statValue && (currentAnim === 'slideUp' || currentAnim === 'fadeInOut' || !currentAnim)) {
                    gsap.fromTo(statValue, {
                        scale: 1,
                        filter: "brightness(1)",
                        color: "#79b436"
                    }, {
                        scrollTrigger: {
                            trigger: section,
                            start: "center 80%", // When center of section hits 60% viewport (sweet spot)
                            end: "center 60%",
                            scrub: 0, // No scrub, just a trigger animation
                            toggleActions: "play reverse play reverse"
                        },
                        scale: 1.25,
                        filter: "brightness(1.2)",
                        color: "#8cd140", // Slightly lighter/brighter green pop
                        duration: 1.0,    // Slower
                        ease: "back.out(1.7)"
                    });
                }

                // 3. Subtle Background Text Animation
                // Parallax effect for subtext to make it feel detached and "floaty"
                if (subtexts.length > 0) {
                    gsap.to(subtexts, {
                        y: -30, // Move up slightly faster than container
                        ease: "none",
                        scrollTrigger: {
                            trigger: section,
                            start: "top bottom",
                            end: "bottom top",
                            scrub: true
                        }
                    });
                }
            });

            // Global Progress Bar
            gsap.to('.progress-bar', {
                width: '100%',
                scrollTrigger: {
                    trigger: '#app',
                    start: 'top top',
                    end: 'bottom bottom',
                    scrub: 0
                }
            });
        });
    </script>
</body>

</html>